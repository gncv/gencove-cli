[tox]
envlist = {py36,py37,py38,py39}-{api_key, user_pass},black,flake8,pylint,bandit

[testenv]
setenv =
    PYTHONPATH={toxinidir}:{toxinidir}/gencove
    GENCOVE_HOST={env:GENCOVE_HOST_TEST:https://www.example.com/}
    ; Passing the API key only if api_key env is being used
    api_key: GENCOVE_API_KEY_TEST={env:GENCOVE_API_KEY_TEST:API_KEY}
    ; Passing the email/pass only if user_pass env is being used
    user_pass: GENCOVE_EMAIL_TEST={env:GENCOVE_EMAIL_TEST:email@example.com}
    user_pass: GENCOVE_PASSWORD_TEST={env:GENCOVE_PASSWORD_TEST:PASSWORD}
    GENCOVE_PROJECT_ID={env:GENCOVE_PROJECT_ID_TEST:11111111-1111-1111-1111-111111111111}
    GENCOVE_PROJECT_ID_BATCHES_TEST={env:GENCOVE_PROJECT_ID_BATCHES_TEST:11111111-1111-1111-1111-111111111111}
    GENCOVE_ARCHIVED_SAMPLE_TEST={env:GENCOVE_ARCHIVED_SAMPLE_TEST:11111111-1111-1111-1111-111111111111}
    GENCOVE_SAMPLE_ID_BATCHES_TEST={env:GENCOVE_SAMPLE_ID_BATCHES_TEST:11111111-1111-1111-1111-111111111111}
    GENCOVE_BATCH_TYPE_TEST={env:GENCOVE_BATCH_TYPE_TEST:Mock batch_type}
    GENCOVE_BATCH_NAME_TEST={env:GENCOVE_BATCH_NAME_TEST:Mock name}
    GENCOVE_BATCH_ID_TEST={env:GENCOVE_BATCH_ID_TEST:11111111-1111-1111-1111-111111111111}

# Dependencies
deps =
    pytest==6.2.4
    pytest-mock==3.6.1
    pytest-cov==2.11.1
    pytest-xdist==2.2.1
    pytest-xdist[psutil]==2.2.1
    pytest-recording==0.12.0
    vcrpy==4.1.1
    faker==8.12.1
# Any command, not just pytest
commands =
    pytest -n auto --cov-config=.coveragerc --cov --cov-append --cov-report term-missing --record-mode=none

# Autoformatter
[testenv:black]
basepython = python3
deps =
    black==21.5b0
commands =
    black --line-length 78 gencove

# Check formatting
[testenv:black_checker]
basepython = python3
deps =
    black==21.5b0
commands =
    black --line-length 78 --check gencove

# Linters
[testenv:flake8]
basepython = python3
deps =
    flake8==3.9.1
    flake8-import-order==0.18.1
    flake8-typing-imports==1.10.1
    pep8-naming==0.11.1
commands =
    flake8 gencove/ setup.py

[testenv:pylint]
basepython = python3
deps =
    pyflakes==2.3.1
    pylint==2.8.2
commands =
# --extension-pkg-whitelist="pydantic" is used to avoid commenting pylint: disable=no-name-in-module
# each time we import from pydantic
    pylint --extension-pkg-whitelist="pydantic" gencove

[testenv:bandit]
basepython = python3
skip_install = true
deps =
    bandit==1.7.0
commands =
    bandit -r gencove/ -x gencove/tests
